{"version":3,"sources":["../../../tmp/1l3a6u4e6/search/src/Search.ts"],"sourcesContent":["import { LitElement, html } from 'lit';\nimport { unsafeHTML } from 'lit/directives/unsafe-html.js';\nimport { SearchStyles } from './Search.styles';\n\nconst beforeHitMatch = 20;\nconst afterHitMatch = beforeHitMatch;\nconst markChar = '\\0';\n\nexport class Search extends LitElement {\n  static styles = SearchStyles;\n\n  public search = null;\n  private hits = null;\n  private keydownListener = null;\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.keydownListener = (e: Event) => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {\n        e.preventDefault();\n        this.updateHits();\n      } else if (e.key === 'Escape') this.hideHits();\n    };\n    addEventListener('keydown', this.keydownListener);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    removeEventListener('keydown', this.keydownListener);\n  }\n\n  render() {\n    return html`<div>\n      <form method=\"dialog\" role=\"search\" novalidate=\"\">\n        <label aria-label=\"Search\">\n          <input\n            aria-autocomplete=\"list\"\n            autocomplete=\"off\"\n            autocorrect=\"off\"\n            autocapitalize=\"off\"\n            spellcheck=\"false\"\n            maxlength=\"64\"\n            type=\"search\"\n            enterkeyhint=\"go\"\n            placeholder=${this.placeHolder}\n            @input=${(e: { target: { value: string } }) =>\n              this.updateHits(e.target.value)}\n            @focus=${(e: { target: { value: string } }) =>\n              this.updateHits(e.target.value)}\n          />\n        </label>\n      </form>\n      <ul class=\"hits\">\n        ${this.hits === null\n          ? html`<li><i>Type for searching...</i></li>`\n          : this.hits.length === 0\n          ? html`<li><i>No match found</i></li>`\n          : this.hits.map(\n              (hit) =>\n                html`<li>\n                  <a href=\"${hit.id}\" @click=${this.hideHits}>\n                    ${unsafeHTML(this.hitHTML(hit))}\n                  </a>\n                </li>`\n            )}\n      </ul>\n      <div class=\"overlay\" @click=${this.hideHits}></div>\n    </div>`;\n  }\n\n  private hitHTML(hit) {\n    return `\n      <header>\n        ${hit.headline}\n        <span class=\"tags\">\n          ${hit.title ? `<span>${hit.title}</span>` : ''}\n          ${hit.section ? `<span>${hit.section}</span>` : ''}\n        </span>\n      </header>\n      ${hit.body ? `<pre class=\"content\">${hit.body}</pre>` : ''}`;\n  }\n\n  private async updateHits(searchValue?: string) {\n    if (!searchValue) {\n      this.hits = null;\n    } else {\n      this.hits = (await this.search?.(searchValue))\n        .filter(Boolean)\n        .slice(0, 10)\n        .map(this.mark)\n        .map((hit) => {\n          hit.headline = this.highlight(hit.headline) || hit.headline;\n          hit.body = this.highlight(hit.body) || ' ';\n          return hit;\n        });\n    }\n    this.searchOverlay.style.display = 'block';\n    this.searchHits.style.display = 'block';\n    this.searchInput.focus();\n    this.searchInput.placeholder = '';\n    this.requestUpdate();\n  }\n\n  private mark(hit) {\n    for (const t of hit.terms.sort((a, b) => b.length - a.length))\n      for (const m of hit.match[t])\n        hit[m] = hit[m]\n          .replace(new RegExp(`([^\\0]?)(${t})([^\\0]?)`, 'gi'), '$1\\0$2\\0$3')\n          .replace(/</gm, '&lt;')\n          .replace(/>/gm, '&gt;');\n    return hit;\n  }\n\n  private highlight(content: string) {\n    const first = content.indexOf(markChar);\n    if (first >= 0) {\n      const last = content.lastIndexOf(markChar);\n      const start = Math.max(0, first - beforeHitMatch);\n      const end = Math.min(\n        Math.max(last, first) + afterHitMatch,\n        content.length\n      );\n      content =\n        (start > 0 ? '...' : '') +\n        content.slice(start, end) +\n        (end < content.length - 1 ? '...' : '');\n      return content.replace(\n        /\\0(.*?)\\0/g,\n        '<strong class=\"highlight\">$1</strong>'\n      );\n    }\n  }\n\n  private hideHits() {\n    this.searchHits.style.display = 'none';\n    this.searchOverlay.style.display = 'none';\n    this.searchInput.value = '';\n    this.searchInput.placeholder = this.placeHolder;\n  }\n\n  private get placeHolder() {\n    return window.navigator.platform === 'MacIntel' ? 'âŒ˜K' : 'Ctrl+K';\n  }\n\n  private get searchInput(): HTMLInputElement {\n    return this.shadowRoot.querySelector('input[type=\"search\"]');\n  }\n\n  private get searchHits(): HTMLUListElement {\n    return this.shadowRoot.querySelector('.hits');\n  }\n\n  private get searchOverlay(): HTMLDivElement {\n    return this.shadowRoot.querySelector('.overlay');\n  }\n}\n"],"names":[],"mappings":"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","sourceRoot":"/source_map/"}