{"version":3,"sources":["../../../tmp/1l3a6u4e6/search/src/indexer.ts"],"sourcesContent":["import type { BuildContext } from '@divriots/studio-doc-compiler';\nimport MiniSearch from 'minisearch';\n\nconst miniSearch = new MiniSearch({\n  fields: ['title', 'headline', 'body', 'section'], // fields to index for full-text search\n  storeFields: ['title', 'headline', 'body', 'section'], // fields to return with search results\n  searchOptions: {\n    boost: { headline: 4, title: 3, section: 2 },\n    fuzzy: 0.2,\n    prefix: true,\n  },\n});\n\nconst docBlocks = new Map();\nfunction indexDoc(content: string, { url, input: file, title, section, base }) {\n  if (docBlocks.has(file)) miniSearch.removeAll(docBlocks.get(file));\n  let heading: RegExpExecArray;\n  const headingRE = /^\\n?(#*)\\s+(.*)\\n\\n([^#]*)/gm;\n  const blocks = [];\n  while ((heading = headingRE.exec(content))) {\n    const [, level, headline, body] = heading;\n    let id = base + url;\n    if (level.length > 1) id += `#${headline.toLowerCase()}`;\n    blocks.push({ id, title, section, headline, body });\n  }\n  docBlocks.set(file, blocks);\n  miniSearch.addAll(blocks);\n}\n\nexport const search = async (\n  searchValue: string,\n  { pages, base }: BuildContext\n) => {\n  if (docBlocks.size === 0)\n    for (const { data, content, ...rest } of pages)\n      indexDoc(content, { base, ...data, ...rest });\n  return miniSearch.search(searchValue);\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,MAAM,aAAa,IAAI,WAAW;AAAA,EAChC,QAAQ,CAAC,SAAS,YAAY,QAAQ;AAAA,EACtC,aAAa,CAAC,SAAS,YAAY,QAAQ;AAAA,EAC3C,eAAe;AAAA,IACb,OAAO,EAAE,UAAU,GAAG,OAAO,GAAG,SAAS;AAAA,IACzC,OAAO;AAAA,IACP,QAAQ;AAAA;AAAA;AAIZ,MAAM,YAAY,IAAI;AACtB,kBAAkB,SAAiB,EAAE,KAAK,OAAO,MAAM,OAAO,SAAS,QAAQ;AAC7E,MAAI,UAAU,IAAI;AAAkB,eAAA,UAAU,UAAU,IAAI;AACxD,MAAA;AACJ,QAAM,YAAY;AAClB,QAAM,SAAS;AACP,SAAA,UAAU,UAAU,KAAK,UAAW;AAC1C,UAAM,CAAG,EAAA,OAAO,UAAU,QAAQ;AAClC,QAAI,KAAK,OAAO;AAChB,QAAI,MAAM,SAAS;AAAG,YAAM,IAAI,SAAS;AACzC,WAAO,KAAK,EAAE,IAAI,OAAO,SAAS,UAAU;AAAA;AAE9C,YAAU,IAAI,MAAM;AACpB,aAAW,OAAO;AAAA;AAGb,MAAM,SAAS,OACpB,aACA,EAAE,OAAO,WACN;AACH,MAAI,UAAU,SAAS;AACV,eAAA,MAA8B,OAC9B;AADA,qBAAE,QAAM,YAAR,IAAoB,iBAApB,IAAoB,CAAlB,QAAM;AACR,eAAA,SAAS,gCAAE,QAAS,OAAS;AAAA;AAC1C,SAAO,WAAW,OAAO;AAAA;;","sourceRoot":"/source_map/"}