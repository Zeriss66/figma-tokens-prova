{"version":3,"file":"api-viewer-tabs.js","sourceRoot":"","sources":["../src/api-viewer-tabs.ts"],"names":[],"mappings":"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","sourcesContent":["import { html } from '@api-viewer/common/lib/utils.js';\nimport { ApiViewerTab } from './api-viewer-tab.js';\nimport type { ApiViewerPanel } from './api-viewer-panel.js';\nimport './api-viewer-panel.js';\n\nconst tpl = html`\n  <style>\n    :host {\n      display: flex;\n      border-bottom-left-radius: var(--ave-border-radius);\n      overflow: hidden;\n    }\n\n    @media (max-width: 600px) {\n      :host {\n        flex-direction: column;\n      }\n\n      .tabs {\n        display: flex;\n        flex-grow: 1;\n        align-self: stretch;\n        overflow-x: auto;\n        -webkit-overflow-scrolling: touch;\n      }\n    }\n  </style>\n  <div class=\"tabs\">\n    <slot name=\"tab\"></slot>\n  </div>\n  <slot name=\"panel\"></slot>\n`;\n\nexport class ApiViewerTabs extends HTMLElement {\n  constructor() {\n    super();\n\n    const root = this.attachShadow({ mode: 'open' });\n    root.appendChild(tpl.content.cloneNode(true));\n\n    const slots = root.querySelectorAll('slot');\n\n    slots[0].addEventListener('slotchange', () => this._linkPanels());\n    slots[1].addEventListener('slotchange', () => this._linkPanels());\n\n    this.addEventListener('keydown', this.handleEvent);\n    this.addEventListener('click', this.handleEvent);\n  }\n\n  connectedCallback(): void {\n    this.setAttribute('role', 'tablist');\n\n    requestAnimationFrame(() => {\n      this._linkPanels();\n    });\n  }\n\n  private _linkPanels(): void {\n    const { tabs } = this;\n    tabs.forEach((tab) => {\n      const panel = tab.nextElementSibling as ApiViewerPanel;\n      tab.setAttribute('aria-controls', panel.id);\n      panel.setAttribute('aria-labelledby', tab.id);\n    });\n\n    const selectedTab = tabs.find((tab) => tab.selected) || tabs[0];\n\n    this._selectTab(selectedTab);\n  }\n\n  get tabs(): ApiViewerTab[] {\n    return Array.from(this.querySelectorAll('api-viewer-tab'));\n  }\n\n  private _getAvailableIndex(idx: number, increment: number): number {\n    const { tabs } = this;\n    const total = tabs.length;\n    for (\n      let i = 0;\n      typeof idx === 'number' && i < total;\n      i++, idx += increment || 1\n    ) {\n      if (idx < 0) {\n        idx = total - 1;\n      } else if (idx >= total) {\n        idx = 0;\n      }\n      const tab = tabs[idx];\n      if (!tab.hasAttribute('hidden')) {\n        return idx;\n      }\n    }\n    return -1;\n  }\n\n  private _prevTab(tabs: ApiViewerTab[]): ApiViewerTab {\n    const newIdx = this._getAvailableIndex(\n      tabs.findIndex((tab) => tab.selected) - 1,\n      -1\n    );\n    return tabs[(newIdx + tabs.length) % tabs.length];\n  }\n\n  private _nextTab(tabs: ApiViewerTab[]): ApiViewerTab {\n    const newIdx = this._getAvailableIndex(\n      tabs.findIndex((tab) => tab.selected) + 1,\n      1\n    );\n    return tabs[newIdx % tabs.length];\n  }\n\n  /**\n   * `reset()` marks all tabs as deselected and hides all the panels.\n   */\n  public reset(): void {\n    this.tabs.forEach((tab) => {\n      tab.selected = false;\n    });\n\n    this.querySelectorAll('api-viewer-panel').forEach((panel) => {\n      panel.hidden = true;\n    });\n  }\n\n  /**\n   * `selectFirst()` automatically selects first non-hidden tab.\n   */\n  public selectFirst(): void {\n    const idx = this._getAvailableIndex(0, 1);\n    this._selectTab(this.tabs[idx % this.tabs.length]);\n  }\n\n  private _selectTab(newTab: ApiViewerTab): void {\n    this.reset();\n\n    const panelId = newTab.getAttribute('aria-controls');\n    const newPanel = this.querySelector(`#${panelId}`) as ApiViewerPanel;\n    if (newPanel) {\n      newTab.selected = true;\n      newPanel.hidden = false;\n    }\n  }\n\n  handleEvent(event: KeyboardEvent | MouseEvent): void {\n    const { target } = event;\n    if (target && target instanceof ApiViewerTab) {\n      let newTab: ApiViewerTab;\n\n      if (event.type === 'keydown') {\n        const { tabs } = this;\n\n        switch ((event as KeyboardEvent).key) {\n          case 'ArrowLeft':\n          case 'ArrowUp':\n            newTab = this._prevTab(tabs);\n            break;\n          case 'ArrowDown':\n          case 'ArrowRight':\n            newTab = this._nextTab(tabs);\n            break;\n          case 'Home':\n            newTab = tabs[0];\n            break;\n          case 'End':\n            newTab = tabs[tabs.length - 1];\n            break;\n          default:\n            // Return to not prevent default.\n            return;\n        }\n\n        event.preventDefault();\n      } else {\n        newTab = target;\n      }\n\n      this._selectTab(newTab);\n      newTab.focus();\n    }\n  }\n}\n\ncustomElements.define('api-viewer-tabs', ApiViewerTabs);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'api-viewer-tabs': ApiViewerTabs;\n  }\n}\n"]}